/*! app.js 2015-10-30 */
angular.module("myApp",["ngRoute","ngCookies","myApp.home"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/home"})}]).controller("mainController",["$scope","$cookies",function(a,b){a.fbCookie=!1;var c=b.get("facebook");if(c){c=c.split("j:"),c=JSON.parse(c[1]);var d={fbUserId:c.fbId,fbUserName:c.fbUserName,fbPicture:c.fbPicture};a.user=d,a.fbCookie=!0}}]),angular.module("myApp.home",["ngRoute"]).config(["$routeProvider",function(a){a.when("/home",{templateUrl:"home/home.html",controller:"homeController"})}]).controller("homeController",["$scope","$log","$http",function(a,b,c){a.map,a.userPosition,a.sitesResults,a.currentKeyword,a.clickedPosition,a.currentRankByFlag;var d,e,f,g,h={lat:37.7833,lng:-122.4167},i="../assets/images/centerFlag.png",j="../assets/images/bluedot.png",k="../assets/images/basketball.png",l="../assets/images/soccer.png",m="../assets/images/squash.png",n="../assets/images/climbing.png",o="../assets/images/tennis.png",p="../assets/images/gym.png",q="../assets/images/golf.png",r="../assets/images/baseball.png",s="../assets/images/racketball.png",t=[];a.sports={Basketball:"Basketball Court",Soccer:"Soccer Field",Tennis:"Tennis Court",Baseball:"Baseball Field",Softball:"Softball Field",Gym:"Gym","Rock Climbing":"Climbing Gym",Golf:"Golf Course",Racquetball:"Racquetball Court",Squash:"Squash Court"},a.loginFacebook=function(){return c({method:"GET",url:"/auth/facebook"}).then(function(a){return a.data})},a.changeLocation=function(a){e=new google.maps.Geocoder,a=$("#location-search").val(),e.geocode({address:a},function(a,b){b==google.maps.GeocoderStatus.OK?(v(a[0].geometry.location,14),u(a[0].geometry.location)):alert("Location change failed because: "+b)})};var u=function(b){void 0==b&&(b=a.map.getCenter()),f=new google.maps.Marker({position:b,icon:i}),f.setMap(a.map)},v=function(b,c){a.map=new google.maps.Map(document.getElementById("map"),{center:b,zoom:c,disableDoubleClickZoom:!0}),d=new google.maps.InfoWindow,a.map.addListener("dblclick",function(b){f&&f.setMap(null),u(b.latLng),a.clickedPosition=b.latLng})};a.userfind=function(){function b(a,b,c){b.setPosition(c),b.setContent(a?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}v(h,12),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.userPosition={lat:b.coords.latitude,lng:b.coords.longitude};var c=new google.maps.Marker({position:a.userPosition,animation:google.maps.Animation.DROP,icon:j});c.setMap(a.map),a.map.setCenter(a.userPosition),a.map.setZoom(14)},function(){b(!0,infoWindow,a.map.getCenter())}):b(!1,infoWindow,a.map.getCenter()),a.$apply()},a.createMarker=function(b,c){var e,f=(b.geometry.location,b.vicinity),g=b.name;e=b.opening_hours&&b.opening_hours.open_now?"Open to play right now!":b.opening_hours&&!b.opening_hours.open_now?"Closed now, but check back again!":"";var h;"Basketball Court"===c&&(h=k),"Soccer Field"===c&&(h=l),"Tennis Court"===c&&(h=o),"Baseball Field"===c&&(h=r),"Softball Field"===c&&(h=softballImage),"Gym"===c&&(h=p),"Climbing Gym"===c&&(h=n),"Golf Course"===c&&(h=q),"Racquetball Court"===c&&(h=s),"Squash Court"===c&&(h=m);var i=new google.maps.Marker({map:a.map,position:b.geometry.location,animation:google.maps.Animation.DROP,icon:h});i.addListener("click",function(){$("*[data-placeId").css("font-weight","normal"),$("*[data-placeId="+b.place_id+"]").css("font-weight","bold"),d.setContent('<div class="infowindow-name">'+g+'</div><div class="infowindow-open">'+e+'</div><div class="infowindow-vicinity">'+f+"</div"),d.open(a.map,this)}),t.push(i)},a.siteListClick=function(a){google.maps.event.trigger(t[a],"click")},a.populateList=function(b,c){function d(c,d){d==google.maps.places.PlacesServiceStatus.OK&&(a.sitesResults=c,a.$apply(),c.forEach(function(c){a.createMarker(c,b)}))}a.currentRankByFlag=c,void 0!=b&&(a.currentKeyword=b),g=void 0==a.clickedPosition?a.map.getCenter():a.clickedPosition;var e={location:g,keyword:[b]};c?_.extend(e,{rankBy:google.maps.places.RankBy.DISTANCE}):_.extend(e,{radius:"2000"}),t.forEach(function(a){a.setMap(null)}),t=[],a.sitesResults=[];var f=new google.maps.places.PlacesService(a.map);f.nearbySearch(e,d)}}]);